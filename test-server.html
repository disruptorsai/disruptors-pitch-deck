<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Presenter Server Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0E0E0E;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #60a5fa;
            border-bottom: 2px solid #60a5fa;
            padding-bottom: 10px;
        }
        .test-section {
            background: #1E1E1E;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
        .warning {
            color: #f59e0b;
        }
        .info {
            color: #60a5fa;
        }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid #333;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-badge.success {
            background: #10b981;
            color: #000;
        }
        .status-badge.error {
            background: #ef4444;
            color: #fff;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #fff;
        }
        button {
            background: #60a5fa;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª AI Presenter Development Server Test</h1>

        <div class="test-section">
            <h2>1. Server Connectivity Test</h2>
            <p>Testing connection to: <strong>http://localhost:5181/</strong></p>
            <div id="connectivity-result">Testing...</div>
        </div>

        <div class="test-section">
            <h2>2. Environment Variables Check</h2>
            <p>Checking if Vite environment variables are properly loaded...</p>
            <div id="env-check-result">Checking...</div>
        </div>

        <div class="test-section">
            <h2>3. React Loading Test</h2>
            <p>Verifying React 19 application loads without errors...</p>
            <div id="react-check-result">Loading...</div>
        </div>

        <div class="test-section">
            <h2>4. Console Logs Capture</h2>
            <p>DEBUG logs from the application:</p>
            <pre id="console-logs">Waiting for logs...</pre>
        </div>

        <div class="test-section">
            <h2>5. Live Application Preview</h2>
            <button onclick="reloadIframe()">Reload Preview</button>
            <button onclick="openInNewTab()">Open in New Tab</button>
            <iframe id="app-preview" src="http://localhost:5181/"></iframe>
        </div>
    </div>

    <script>
        const logs = [];
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        // Test 1: Connectivity
        async function testConnectivity() {
            try {
                const response = await fetch('http://localhost:5181/');
                if (response.ok) {
                    document.getElementById('connectivity-result').innerHTML =
                        '<span class="success">âœ“ Server is responding</span><span class="status-badge success">ONLINE</span>';
                    return true;
                } else {
                    document.getElementById('connectivity-result').innerHTML =
                        '<span class="error">âœ— Server returned status: ' + response.status + '</span><span class="status-badge error">ERROR</span>';
                    return false;
                }
            } catch (error) {
                document.getElementById('connectivity-result').innerHTML =
                    '<span class="error">âœ— Cannot connect: ' + error.message + '</span><span class="status-badge error">OFFLINE</span>';
                return false;
            }
        }

        // Test 2: Check for configuration errors in iframe
        function checkEnvironmentVariables() {
            setTimeout(() => {
                const iframe = document.getElementById('app-preview');
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const configError = iframeDoc.querySelector('h1');

                    if (configError && configError.textContent.includes('Configuration')) {
                        document.getElementById('env-check-result').innerHTML =
                            '<span class="error">âœ— Configuration Error Detected</span><span class="status-badge error">MISSING ENV VARS</span>';
                    } else if (iframeDoc.getElementById('root') && iframeDoc.getElementById('root').children.length > 0) {
                        document.getElementById('env-check-result').innerHTML =
                            '<span class="success">âœ“ Environment variables loaded successfully</span><span class="status-badge success">OK</span>';
                    } else {
                        document.getElementById('env-check-result').innerHTML =
                            '<span class="warning">âš  Still loading...</span>';
                    }
                } catch (e) {
                    document.getElementById('env-check-result').innerHTML =
                        '<span class="info">â„¹ Cannot access iframe (CORS). Check browser console.</span>';
                }
            }, 3000);
        }

        // Test 3: React loading
        function checkReactLoading() {
            setTimeout(() => {
                const iframe = document.getElementById('app-preview');
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const root = iframeDoc.getElementById('root');

                    if (root && root.children.length > 0) {
                        document.getElementById('react-check-result').innerHTML =
                            '<span class="success">âœ“ React 19 loaded successfully</span><span class="status-badge success">RUNNING</span>';
                    } else {
                        document.getElementById('react-check-result').innerHTML =
                            '<span class="error">âœ— React app did not render</span><span class="status-badge error">FAILED</span>';
                    }
                } catch (e) {
                    document.getElementById('react-check-result').innerHTML =
                        '<span class="warning">âš  Cannot verify (CORS). Check browser console.</span>';
                }
            }, 4000);
        }

        // Monitor console logs
        function setupConsoleCapture() {
            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    logs.push({
                        type: method,
                        message: args.map(arg =>
                            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                        ).join(' '),
                        timestamp: new Date().toISOString()
                    });
                    updateConsoleDisplay();
                    originalConsole[method].apply(console, args);
                };
            });
        }

        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-logs');
            if (logs.length === 0) {
                consoleDiv.textContent = 'No logs captured yet. Check browser console (F12) for live logs.';
            } else {
                consoleDiv.innerHTML = logs.map(log =>
                    `<div class="${log.type}">[${log.type.toUpperCase()}] ${log.message}</div>`
                ).join('\n');
            }
        }

        function reloadIframe() {
            document.getElementById('app-preview').src = 'http://localhost:5181/';
            setTimeout(() => {
                checkEnvironmentVariables();
                checkReactLoading();
            }, 2000);
        }

        function openInNewTab() {
            window.open('http://localhost:5181/', '_blank');
        }

        // Run tests
        async function runTests() {
            setupConsoleCapture();
            await testConnectivity();
            checkEnvironmentVariables();
            checkReactLoading();
        }

        // Start tests when page loads
        window.addEventListener('load', runTests);

        // Update console display every 2 seconds
        setInterval(updateConsoleDisplay, 2000);
    </script>
</body>
</html>
